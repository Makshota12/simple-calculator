name: Simple CI

on:
  push:
    branches: [ main, development ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Run tests
      run: python tests/test_calculator.py

  docs:
    runs-on: ubuntu-latest
    needs: test
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Generate function documentation
      run: |
        echo "# Auto-generated Function List" > docs/functions.md
        echo "Last updated: $(date)" >> docs/functions.md
        echo "" >> docs/functions.md
        echo "## Calculator Functions" >> docs/functions.md
        echo "" >> docs/functions.md
        echo "- **add(a, b)** - Returns sum of two numbers" >> docs/functions.md
        echo "- **subtract(a, b)** - Returns difference of two numbers" >> docs/functions.md
        echo "- **multiply(a, b)** - Returns product of two numbers" >> docs/functions.md
        echo "- **divide(a, b)** - Returns quotient, raises error if divisor is zero" >> docs/functions.md
        echo "" >> docs/functions.md
        echo "*Automatically generated by CI*" >> docs/functions.md
    
    - name: Commit documentation
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add docs/functions.md
        git diff --staged --quiet || git commit -m "Auto-update documentation"
        git push