name: CI with Auto-Docs

on:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Run tests
      run: |
        python -c "import calculator; print('2+2 =', calculator.add(2, 2))"
        python -c "import calculator; print('5-3 =', calculator.subtract(5, 3))"
        python -c "import calculator; print('3*4 =', calculator.multiply(3, 4))"

  docs:
    runs-on: ubuntu-latest
    needs: test
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.AUTO_DOCS_TOKEN }}
        
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    - name: Create docs directory
      run: mkdir -p docs
    
    - name: Generate documentation
      run: |
        echo "# ðŸ“š Calculator Documentation" > docs/README.md
        echo "" >> docs/README.md
        echo "## Available Functions" >> docs/README.md
        echo "" >> docs/README.md
        echo "- **add(a, b)** - Adds two numbers" >> docs/README.md
        echo "- **subtract(a, b)** - Subtracts two numbers" >> docs/README.md
        echo "- **multiply(a, b)** - Multiplies two numbers" >> docs/README.md
        echo "" >> docs/README.md
        echo "## Quick Start" >> docs/README.md
        echo '```python' >> docs/README.md
        echo "from calculator import add, subtract, multiply" >> docs/README.md
        echo "" >> docs/README.md
        echo "result = add(2, 3)      # 5" >> docs/README.md
        echo "result = subtract(5, 3) # 2" >> docs/README.md
        echo "result = multiply(3, 4) # 12" >> docs/README.md
        echo '```' >> docs/README.md
        echo "" >> docs/README.md
        echo "*Last updated: $(date)*" >> docs/README.md

    - name: Commit and push documentation
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add docs/
        git diff --staged --quiet || git commit -m "ðŸ“š Auto-update documentation"
        git push